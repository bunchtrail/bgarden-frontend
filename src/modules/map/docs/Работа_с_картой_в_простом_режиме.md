# Работа с картой в простом режиме изображения

## Обзор функциональности

Данные изменения позволяют полноценно работать с картой в простом режиме изображения (Simple Image Mode), избегая ошибки "Карта не готова для добавления точек или режим не соответствует", которая возникала из-за того, что форма добавления растений ожидала интерактивный экземпляр карты Leaflet.

## Ключевые изменения

1. **Адаптирована логика PlantAddForm.tsx**:

   - Добавлена проверка режима простого изображения (`state.isSimpleImageMode`), чтобы обходить проверку на наличие экземпляра карты Leaflet
   - Добавлен отдельный обработчик события `map-image-click`, позволяющий получать координаты от клика по простому изображению

2. **Улучшена работа с простым режимом в MapContainer.tsx**:

   - Добавлен обработчик клика по изображению, преобразующий координаты в формат, совместимый с геоданными
   - Реализована визуализация выбранной точки на карте в простом режиме
   - Добавлен индикатор для пользователя, уведомляющий о возможности выбора позиции на карте
   - Реализована очистка маркера при выходе из режима добавления растений

3. **Механизм взаимодействия**:
   - Координаты при клике на изображение преобразуются из относительных (x, y от 0 до 1) в псевдо-географические (широта/долгота)
   - Для передачи координат между компонентами используется система пользовательских событий DOM (`CustomEvent`)

## Использование

1. Переключитесь в "Простой вид" карты с помощью переключателя в верхней части страницы
2. Переключитесь в режим добавления растения через панель инструментов
3. Кликните по изображению карты для выбора местоположения
4. На изображении появится красный маркер, а координаты будут переданы в форму
5. Заполните остальные поля формы и добавьте растение

## Техническая реализация

В простом режиме карты:

1. Координаты пикселей изображения (относительные 0-1) конвертируются в условные географические (широта 55-56, долгота 37-38)
2. Создается DOM-событие `map-image-click` с деталями координат
3. PlantAddForm подписывается на это событие и получает координаты для установки позиции растения

### Особенности реализации и устранение ошибок

1. **Соблюдение правил хуков React:**

   - Хук `useMapContext` вызывается только на верхнем уровне компонента `MapContainerContent`
   - Внутри обработчика `onClick` используются переменные, полученные из хука на уровне компонента
   - Такой подход соответствует правилам React Hooks и избегает ошибки линтера "React Hook cannot be called inside a callback"

2. **Обмен данными:**
   - Вместо прямых вызовов функций между компонентами используется система DOM-событий
   - Это позволяет организовать слабосвязанную архитектуру, которая легко расширяется

## Дальнейшие улучшения

1. Реализовать более точную систему координат для простого режима, с возможной привязкой к реальным геоданным
2. Добавить возможность перетаскивания маркера в простом режиме
3. Улучшить визуализацию существующих растений на простом изображении карты
