# Модуль карты для Ботанического сада

Модуль предоставляет интерактивную карту для управления растениями в ботаническом саду с использованием библиотеки Leaflet.

## Возможности

- Отображение карты с растениями по секторам (дендрологический, флора, цветущие)
- Добавление новых растений на карту
- Редактирование информации о растениях
- Удаление растений с карты
- Просмотр детальной информации о растениях

## Структура модуля

```
map/
  ├── components/           # Компоненты модуля
  │   ├── forms/            # Формы для работы с растениями
  │   │   ├── PlantAddForm.tsx
  │   │   └── PlantEditForm.tsx
  │   ├── layers/           # Слои карты
  │   │   └── PlantLayer.tsx
  │   ├── markers/          # Маркеры на карте
  │   │   └── PlantMarker.tsx
  │   ├── Map.tsx           # Основной компонент карты
  │   ├── MapContainer.tsx  # Контейнер с провайдером контекста
  │   └── MapControls.tsx   # Элементы управления картой
  ├── contexts/             # Контексты для управления состоянием
  │   └── MapContext.tsx
  ├── hooks/                # Хуки для работы с картой
  │   ├── index.ts
  │   └── useMapControls.ts
  ├── services/             # Сервисы для работы с API
  │   └── mapService.ts
  ├── types/                # Типы и интерфейсы
  │   └── index.ts
  ├── utils/                # Утилиты
  ├── index.ts              # Точка входа в модуль
  └── README.md             # Документация
```

## Использование

### Базовое использование

```tsx
import { MapContainer } from '../modules/map';

const MapPage: React.FC = () => {
  return (
    <div className='map-page'>
      <h1>Карта ботанического сада</h1>
      <MapContainer mapId={1} />
    </div>
  );
};

export default MapPage;
```

### Выбор сектора

```tsx
import { MapContainer } from '../modules/map';
import { SectorType } from '../modules/specimens/types';

const FloraMapPage: React.FC = () => {
  return (
    <div className='map-page'>
      <h1>Карта сектора флоры</h1>
      <MapContainer mapId={1} sectorType={SectorType.Flora} />
    </div>
  );
};

export default FloraMapPage;
```

## Зависимости

- React 19.0.0
- Leaflet 1.9.4
- react-leaflet 5.0.0
- TypeScript 4.9.5
- Tailwind CSS 3.3.0

## API

Модуль взаимодействует с API через сервис `mapService`, который предоставляет следующие методы:

- `getMapById(id: number)` - получение карты по ID
- `getMapWithSpecimens(id: number)` - получение карты со всеми образцами растений
- `getAllMaps()` - получение списка всех карт
- `getSpecimensBySector(sectorType: SectorType)` - получение образцов растений по типу сектора
- `addSpecimen(specimen: Omit<Specimen, 'id'>)` - добавление нового образца растения
- `updateSpecimen(id: number, specimen: Specimen)` - обновление существующего образца растения
- `deleteSpecimen(id: number)` - удаление образца растения

## Режим простого изображения карты

В модуле реализован режим простого изображения карты, который заменяет глобальную интерактивную карту на собственное изображение ботанического сада. Данное решение предназначено для сотрудников и точно отражает геометрию ботанического сада.

### Основные возможности

- Отображение собственного изображения ботанического сада вместо глобальной карты
- Отображение растений на карте с помощью маркеров
- Выбор позиции для добавления новых растений
- Интеграция с формой добавления растений

### Как это работает

1. При загрузке приложения активируется режим простого изображения карты
2. Загружается изображение карты ботанического сада
3. На изображении отображаются маркеры существующих растений
4. При переключении в режим добавления растения, пользователь может кликнуть по карте для выбора позиции
5. Координаты передаются в форму добавления растения
6. После заполнения всех полей формы, растение добавляется на карту

### Координаты на карте

Для хранения географических координат в простом режиме используются условные координаты:

- Широта (latitude): от 55 до 56
- Долгота (longitude): от 37 до 38

Относительные координаты на изображении (0-1) преобразуются в этот диапазон для совместимости с существующей архитектурой.

### Техническая реализация

Для реализации режима простого изображения были модифицированы следующие компоненты:

1. **MapContainer.tsx** - основной контейнер, в котором отображается изображение и маркеры
2. **Map.tsx** - компонент отключается в режиме простого изображения
3. **PlantAddForm.tsx** - форма адаптирована для работы с простым режимом карты
4. **MapContext.tsx** - контекст содержит флаг `isSimpleImageMode`

Для обмена данными между компонентами используются события DOM:

- `map-image-click` - передает координаты клика по изображению в форму добавления растения

### Дальнейшее развитие

Планируемые улучшения:

1. Добавление возможности перетаскивания маркеров
2. Масштабирование изображения карты
3. Отображение дополнительной информации при наведении на маркер
4. Интеграция с режимом редактирования растений
