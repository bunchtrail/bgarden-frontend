# Модуль карты

## Обновления от 27.03.2025: Устранение дублирования кода для работы с регионами

### Проблема
В проекте было обнаружено дублирование логики создания (рисования) областей на карте в нескольких компонентах:
- `MapDrawingLayer.tsx` - для рисования и редактирования областей
- `MapRegionsLayer.tsx` - для отображения существующих регионов
- `RegionMapSelector.tsx` - в модуле specimens для выбора регионов

Также были обнаружены дублирующиеся сервисы:
- `src/modules/map/services/regionService.ts`
- `src/modules/specimens/services/regionService.ts`

### Решение
1. **Общий сервис для работы с регионами**
   - Создан единый сервис `src/services/regionService.ts`, объединяющий функциональность обоих сервисов
   - Стандартизирована обработка ошибок и форматирование данных

2. **Утилиты для работы с полигонами**
   - Создан файл `src/utils/regionUtils.ts` с общими функциями для работы с полигонами
   - Выделены общие функции: `createPolygonStyles`, `createPolygonEventHandlers`, `makePolygonDraggable`

3. **Фабрика полигонов**
   - Реализован класс `MapPolygonFactory` для создания полигонов в `src/services/MapPolygonFactory.ts`
   - Добавлены методы для создания стилей, обработчиков событий и полигонов с учетом типизации

4. **Обновлены компоненты**
   - `MapRegionsLayer.tsx` теперь использует общие утилиты вместо собственной реализации стилей и обработчиков
   - Готовы для рефакторинга: `MapDrawingLayer.tsx` и другие компоненты, работающие с регионами

### Преимущества
1. **Единообразие** - все компоненты используют одинаковую логику создания и стилизации областей
2. **Устранение дублирования** - общий код вынесен в отдельные утилиты
3. **Улучшенная типизация** - добавлены корректные типы для улучшения проверки типов
4. **Улучшенная поддерживаемость** - изменения в логике работы с областями теперь нужно вносить только в одном месте

### Следующие шаги
1. Обновить `MapDrawingLayer.tsx` для использования новых утилит
2. Обновить компоненты в модуле specimens для использования общего сервиса regionService
3. Удалить дублирующиеся сервисы после полного перехода на общий сервис

## Другие разделы документации

... 