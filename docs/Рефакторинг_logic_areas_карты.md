# Рефакторинг дублирующейся логики областей карты

## Обнаруженные проблемы

В результате анализа кодовой базы были обнаружены следующие проблемы дублирования:

1. **Дублирование сервисов работы с регионами**:
   - `src/services/regionService.ts`
   - `src/modules/map/services/regionService.ts`

2. **Дублирование логики создания полигонов**:
   - `src/services/MapPolygonFactory.ts`
   - `src/utils/regionUtils.ts`

3. **Дублирование функций и утилит**:
   - Функции типа `parseCoordinates`, `getDefaultCoordinates`, `createPolygonStyles` и другие присутствуют в разных файлах

## Выполненные изменения

1. **Создана унифицированная структура для работы с регионами**:
   - Новый каталог `src/services/regions/` для всех сервисов, связанных с регионами
   - Унифицированный сервис `src/services/regions/RegionService.ts`
   - Унифицированная фабрика `src/services/regions/PolygonFactory.ts`
   - Индексный файл `src/services/regions/index.ts` для экспорта всех функций

2. **Обновлены компоненты**:
   - Обновлен компонент `src/modules/map/components/map-components/MapRegionsLayer.tsx` 
     для использования новых унифицированных сервисов

3. **Проверена компиляция проекта**:
   - Проект успешно компилируется после первых изменений, подтверждая работоспособность 
     обновленных компонентов

## План дальнейшего рефакторинга

1. **Обновить остальные компоненты, использующие устаревшие сервисы**:
   - `src/modules/map/components/map-layers/MapDrawingLayer.tsx`
   - Все компоненты, использующие `MapPolygonFactory` или функции из `regionUtils`

2. **Переместить старые файлы в архив**:
   - После полного перехода переместить устаревшие файлы в каталоги `deprecated` 
     для сохранения истории изменений

3. **Обновить импорты во всех затронутых компонентах**:
   - Заменить все импорты вида `import ... from '@/services/regionService'` 
     на `import ... from '@/services/regions'`

4. **Документация и комментарии**:
   - Добавить документирующие комментарии к новым файлам
   - Обновить README соответствующих модулей с информацией об изменениях

## Преимущества рефакторинга

1. **Устранение дублирования кода**:
   - Единый источник истины для логики работы с регионами и полигонами
   - Легче поддерживать и обновлять код

2. **Улучшение организации кода**:
   - Логически связанные функции находятся в одном месте
   - Более понятная структура проекта

3. **Упрощение разработки**:
   - Разработчикам проще найти и использовать нужную функциональность
   - Снижение риска введения противоречивой логики

## Следующие шаги

1. Рефакторинг оставшихся компонентов
2. Добавление автоматических тестов для новых сервисов
3. Обновление документации проекта 